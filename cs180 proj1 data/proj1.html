<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>CS180 Project 1 — Prokudin‑Gorskii Colorizing</title>
  <style>
    :root { --fg:#0f172a; --muted:#475569; --link:#2563eb; --bg:#ffffff; --border:#e2e8f0; --card:#f8fafc; }
    * { box-sizing: border-box; }
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif; margin: 0; color: var(--fg); background: var(--bg); }
    header { padding: 28px 20px; background: linear-gradient(180deg, #eef2ff, #ffffff); border-bottom: 1px solid var(--border); }
    .container { max-width: 980px; margin: 0 auto; padding: 0 20px; }
    h1 { margin: 0 0 8px; font-size: 28px; }
    h2 { margin: 28px 0 8px; font-size: 22px; }
    h3 { margin: 20px 0 8px; font-size: 18px; }
    p, li { color: var(--muted); line-height: 1.65; }
    a { color: var(--link); text-decoration: none; }
    a:hover { text-decoration: underline; }
    nav.breadcrumb { font-size: 14px; margin-top: 6px; }
    .toc { background: var(--card); border:1px solid var(--border); border-radius: 10px; padding: 12px 16px; }
    .toc ul { margin: 8px 0 0 16px; }
    .code { font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace; background: #0b1220; color: #e2e8f0; padding: 10px 12px; border-radius: 8px; overflow:auto; font-size: 13px; }
    .callout { border-left: 4px solid #818cf8; background: #f5f7ff; padding: 10px 12px; border-radius: 6px; }
    .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(240px, 1fr)); gap: 12px; }
    figure { margin: 0; border: 1px solid var(--border); border-radius: 8px; overflow: hidden; background: #fff; }
    figure img { display:block; width:100%; height:auto; }
    figure figcaption { font-size: 13px; color: var(--muted); padding: 8px 10px; border-top: 1px solid var(--border); }
    footer { padding: 28px 20px; border-top: 1px solid var(--border); color: var(--muted); font-size: 14px; margin-top: 36px; }
    .offsets td, .offsets th { padding: 6px 10px; border-bottom: 1px solid var(--border); text-align: left; font-size: 14px; }
    .offsets { border-collapse: collapse; width: 100%; }
  </style>
</head>
<body>
  <header>
    <div class="container">
      <h1>CS180 Project 1 — Prokudin‑Gorskii Colorizing</h1>
      <nav class="breadcrumb"><a href="../index.html">← Back to Projects</a></nav>
    </div>
  </header>

  <main class="container">
    <section class="toc">
      <strong>Contents:</strong>
      <ul>
        <li><a href="#overview">Project Overview</a></li>
        <li><a href="#part1">Part 1: Single‑Scale Alignment</a></li>
        <li><a href="#results">Results & Offsets</a></li>
        <li><a href="#part2">Part 2: Multi‑Scale Pyramid Alignment</a></li>
      </ul>
    </section>

    <section id="overview">
      <h2>Project Overview</h2>
      <p>
        This project focuses on reconstructing color photographs from the Prokudin‑Gorskii collection.
        The collection contains three separate black‑and‑white images of a scene, each through a different
        color filter: red, green, and blue. The primary challenge is to take these three individual color
        channel images and digitally align them. By correctly layering the red, green, and blue channels,
        we can recreate the full‑color photograph.
      </p>
    </section>

    <section id="part1">
      <h2>Part 1: Single‑Scale Alignment</h2>
      <h3>My Approach</h3>
      <p>
        - Split the input plate into three equal vertical thirds (top→bottom = B, G, R) and convert to float in [0,1].<br/>
        - Crop a small outer frame from each channel for robustness on small images (e.g., <code>border = H//15</code>).<br/>
        - For each channel to align (G→B, R→B), exhaustively search a window <code>dy,dx ∈ [−search_range, +search_range]</code>
          around a center (default (0,0)).<br/>
        - For a candidate shift, compute the valid overlap between reference (B) and target (G or R) using an
          overlap-crop helper; then compute a score on the interior by trimming an inner margin
          <code>inner_border = max(5, min(H,W)//50)</code> to suppress border artifacts.<br/>
        - Scoring: L2 uses negative sum of squared differences (maximize), NCC uses normalized cross‑correlation (maximize).<br/>
        - Keep the best shift, then apply with <code>np.roll</code>; finally stack <code>[aligned R, aligned G, B]</code> and save.
      </p>
      <p class="meta">Key functions: <code>single_scale_search</code> (core search), <code>single_scale_align</code> (IO + print/save).</p>
    </section>

    

    

    <section id="results">
      <h2>Results & Offsets</h2>
      <p>
        First, single‑scale alignment using L2 (Euclidean distance) on the three small images
        you listed. Offsets are printed as <code>(x, y)</code> where <code>x</code> is row shift
        and <code>y</code> is column shift, matching your notebook prints.
      </p>
      <table class="offsets">
        <thead><tr><th>Image</th><th>G offset (x, y)</th><th>R offset (x, y)</th></tr></thead>
        <tbody>
          <tr><td>monastery.jpg</td><td>(-3, 2)</td><td>(3, 2)</td></tr>
          <tr><td>tobolsk.jpg</td><td>(3, 3)</td><td>(6, 3)</td></tr>
          <tr><td>cathedral.jpg</td><td>(5, 2)</td><td>(12, 3)</td></tr>
        </tbody>
      </table>

      <h3>Single‑Scale (L2) — Thumbnails</h3>
      <div class="grid">
        <figure>
          <img src="output/single_scale_aligned_euclidean_distance_monastery.jpg" alt="Monastery (single-scale L2)" />
          <figcaption>Monastery — Green offset: (-3, 2) · Red offset: (3, 2)</figcaption>
        </figure>
        <figure>
          <img src="output/single_scale_aligned_euclidean_distance_tobolsk.jpg" alt="Tobolsk (single-scale L2)" />
          <figcaption>Tobolsk — Green offset: (3, 3) · Red offset: (6, 3)</figcaption>
        </figure>
        <figure>
          <img src="output/single_scale_aligned_euclidean_distance_cathedral.jpg" alt="Cathedral (single-scale L2)" />
          <figcaption>Cathedral — Green offset: (5, 2) · Red offset: (12, 3)</figcaption>
        </figure>
      </div>
    </section>

    <section id="part2">
      <h2>Part 2: Multi‑Scale Pyramid Alignment</h2>
      <h3>My Approach</h3>
      <p>
        - Preprocess: for large plates, trim a wider outer border (e.g., <code>border = H//10</code>) to avoid strong edges.<br/>
        - Build pyramids for B/G/R by downscaling by 2 for <code>num_levels = 6</code> (coarsest → finest).<br/>
        - Coarse level: run the same single‑scale search with NCC to get initial shifts <code>(dy,dx)</code> for G and R.<br/>
        - Propagation: scale the coarse shifts by the downscale factor to the next finer level and use them as
          centers for a small local search (e.g., <code>search_range = 5</code>).<br/>
        - At the finest level, apply the final shifts via <code>np.roll</code> to form the RGB output and save.
      </p>
      <p class="meta">Key functions: <code>pyramid_search</code> (recursive coarse→fine with centers), <code>single_scale_search</code> (NCC).</p>

      <h3>Large Images</h3>

      <table class="offsets">
        <thead><tr><th>Image</th><th>G offset (x, y)</th><th>R offset (x, y)</th></tr></thead>
        <tbody>
          <tr><td>Church</td><td>(25, 4)</td><td>(58, -4)</td></tr>
          <tr><td>Emir</td><td>(49, 24)</td><td>(107, 40)</td></tr>
          <tr><td>Harvesters</td><td>(60, 17)</td><td>(124, 14)</td></tr>
          <tr><td>Icon</td><td>(42, 17)</td><td>(90, 23)</td></tr>
          <tr><td>Italil</td><td>(38, 22)</td><td>(77, 36)</td></tr>
          <tr><td>Lastochikino</td><td>(-3, -2)</td><td>(76, -8)</td></tr>
          <tr><td>Lugano</td><td>(41, -17)</td><td>(92, -29)</td></tr>
          <tr><td>Melons</td><td>(80, 10)</td><td>(177, 13)</td></tr>
          <tr><td>Self Portrait</td><td>(78, 29)</td><td>(176, 37)</td></tr>
          <tr><td>Siren</td><td>(49, -6)</td><td>(96, -24)</td></tr>
          <tr><td>Three Generations</td><td>(54, 12)</td><td>(111, 9)</td></tr>
        </tbody>
      </table>

      <h3>Thumbnails</h3>
      <div class="grid">
        <figure>
          <img src="output/pyramid_aligned_ncc_church.jpg" alt="Church (pyramid + NCC)" />
          <figcaption>Church — Green: (25, 4) · Red: (58, -4)</figcaption>
        </figure>
        <figure>
          <img src="output/pyramid_aligned_ncc_emir.jpg" alt="Emir (pyramid + NCC)" />
          <figcaption>Emir — Green: (49, 24) · Red: (107, 40)</figcaption>
        </figure>
        <figure>
          <img src="output/pyramid_aligned_ncc_harvesters.jpg" alt="Harvesters (pyramid + NCC)" />
          <figcaption>Harvesters — Green: (60, 17) · Red: (124, 14)</figcaption>
        </figure>
        <figure>
          <img src="output/pyramid_aligned_ncc_icon.jpg" alt="Icon (pyramid + NCC)" />
          <figcaption>Icon — Green: (42, 17) · Red: (90, 23)</figcaption>
        </figure>
        <figure>
          <img src="output/pyramid_aligned_ncc_italil.jpg" alt="Italil (pyramid + NCC)" />
          <figcaption>Italil — Green: (38, 22) · Red: (77, 36)</figcaption>
        </figure>
        <figure>
          <img src="output/pyramid_aligned_ncc_lastochikino.jpg" alt="Lastochikino (pyramid + NCC)" />
          <figcaption>Lastochikino — Green: (-3, -2) · Red: (76, -8)</figcaption>
        </figure>
        <figure>
          <img src="output/pyramid_aligned_ncc_lugano.jpg" alt="Lugano (pyramid + NCC)" />
          <figcaption>Lugano — Green: (41, -17) · Red: (92, -29)</figcaption>
        </figure>
        <figure>
          <img src="output/pyramid_aligned_ncc_siren.jpg" alt="Siren (pyramid + NCC)" />
          <figcaption>Siren — Green: (49, -6) · Red: (96, -24)</figcaption>
        </figure>
        <figure>
          <img src="output/pyramid_aligned_ncc_melons.jpg" alt="Melons (pyramid + NCC)" />
          <figcaption>Melons — Green: (80, 10) · Red: (177, 13)</figcaption>
        </figure>
        <figure>
          <img src="output/pyramid_aligned_ncc_self_portrait.jpg" alt="Self Portrait (pyramid + NCC)" />
          <figcaption>Self Portrait — Green: (78, 29) · Red: (176, 37)</figcaption>
        </figure>
        <figure>
          <img src="output/pyramid_aligned_ncc_three_generations.jpg" alt="Three Generations (pyramid + NCC)" />
          <figcaption>Three Generations — Green: (54, 12) · Red: (111, 9)</figcaption>
        </figure>
      </div>
    </section>
  </main>

  <footer>
    <div class="container">© Fangzhou — CS180 Project 1</div>
  </footer>
</body>
</html>
